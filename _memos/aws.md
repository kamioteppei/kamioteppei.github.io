---
layout: static
title: AWS
template: 3-columns
name: AWS
category: Environment
---

# AWS

Amazon Web Services

## 基本

以下を参照

[「AWS is 何」を3行でまとめてみる](https://qiita.com/kohashi/items/1bb952313fb695f12577)

## IAM

AWS Identity and Access Managementの略  

AWSサービスやリーソースに対するアクセスの権限管理の設定  
デフォルトのrootユーザーは通常は使用しない。  
IAMユーザーは、関係者1人につき1つ発行する。  
定期的に、各IAMユーザーの権限の見直しと、不要なIAMユーザーの削除を行う。

- IAMユーザー
- IAMグループ
- IAMロール

## アクセスキーとシークレットアクセスキー

AWSマネージメントコンソールのみで運用する場合は、キーを発行しない。  
ローカルのコマンドラインからEC2にSSH接続する場合や、EC2のプログラム内で、  
他のAWSリーソース(RDS)にアクセスする場合等に使用する。  
ただし、プログラムにキーをハードコーディングしてはいけない。Githubにあげたらもっとだめ。  
IAMロールを上手く活用する方法での、AWSの連携がおすすめらしい。  
コマンドラインでAWSの管理操作をする場合は、AWS CLIをローカルにインストールする。  
EC2インスタンスにアクセスするだけなら、ターミナルからSSHで接続すれば良い。  
プログラムからAWSにアクセスする場合は、SDK APIを使用する。

## VPC

以下のAWSサービスを自分のアカウントのVPC内に配置する。

- EC2(汎用サーバー)
- RDS(マネージドなRDBサービス)
- Redshift(分析用データベース)
- EMR(hadoop)

VPC内では、インターネットに公開する、パブリックなサブネットと、  
非公開のプライベートなサブネットを作成する。

パブリックなサブネットで公開するサービス
- EC2   
この場合、EC2のインバウンドで、sshとhttp,https用のポートのみ許可する。  
sshの設定では、IPは管理者のグローバルIPのみを受け付ける。  
httpの設定では、IPは0.0.0.0/0(制限なし)を受け付ける。

プライベートなサブネットで公開するサービス
- RDS   
この場合、RDSのインバウンドで、rds用のポートのみ許可する。  
EC2のサブネットからの接続のみを受け付ける。  
または、Webサーバ(EC2インスタンス)に設定されている、
セキュリティーグループを指定する。

下記のサービスは、VPC外のAWS内のパブリックなサービスとなる。  
- S3(Simple Strage Service)
- Lambda
- DynamoDB
- CloudWatch

## インターネットゲートウェイとNATゲートウェイ

- インターネットゲートウェイ  
インターネットとVPC内のパブリックなEC2インスタンスを中継するルート
  - ElasticIPを割り振ると、IPが固定されるが、EC2を起動しない時間に料金が発生する。

- NATゲートウェイ  
インターネットとVPC内のプライベートなEC2インスタンスを、一時的に中継できるようにするルート   
  - NATゲートウェイを使用する目的は、プライベートなEC2インスタンスでも、1時的にモジュールの取得、更新なので、インターネットに接続する必要がある為。
  - パブリックなサブネットワークにNATゲートウェイを作成する。この時、ElasticIPを割り振っているので、NATゲートウェイの削除時に、ElasticIPも削除する。削除しないと料金がかかる。
  - プライベートのサブネットのルートテーブルに、設定を追加し、外部との通信は、NATゲートウェイを使用するようにする。
  - インターネットに接続する作業が終了したら、NATゲートウェイを削除する。ルートテーブルを戻す。ElasticIPも解放する。

## セキュリティーグループとネットワークACL

- セキュリティグループ  
EC２インスタンスのファイアーウォール設定

- ネットワークACL  
サブネットワークのファイアーウォール設定  
インバウンドとアウトバウンドの設定を分けて設定できる。(ステートレス)

## EC2

Amazon Elastic Compute Cloudの略

ミドルウェアをインストールして、下記の用途に使用する。

- Webサーバー
- アプリサーバー
- DBサーバー
- バッチサーバー

## サーバーレスアーキテクチャー

VPCとその中のWebサーバーや、DBを使用せずに、  
AWSのLambda、S3、DynamoDB等で構成するサービス
