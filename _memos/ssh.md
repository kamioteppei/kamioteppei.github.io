---
layout: static
title: SSH
template: 3-columns
name: SSH
category: Environment
---

# SSH(Secure Shell)

## 基本

基本的な説明は以下を参照  
[SSHなるものをよくわからずに使っている人のための手引書](https://qiita.com/kenju/items/b09199c4b3e7203a2867)

要はクライアントからサーバーに、セキュアに通信する為の  
設定のこと。

設定の方法は  簡略化して言うと
1. クライアントで、そのクライアントの  
秘密鍵と公開鍵を生成する。
1. 公開鍵のみを、サーバーに登録する。
1. あとは通信時に、お互いに上手くやってくれる。  

---
## クライアントのファイル構成

クライアントのユーザーの直下の階層に1意に作成する。
```
$ cd ~
```
おそらく、１つのクライアントでは、  
多分１回だけ鍵を生成すれば良いと思う。  
複数のサービス(サーバー)に接続する場合でも  
自分の公開鍵は使い回しできると思う。

macの場合は、`/Users/kamioteppei/`の直下に、以下を作成する。  
ただし、作成の前に、`$ ls -a`で確認して、既に存在する場合は不要。

SSH設定ディレクトリ(隠しディレクトリ)
- .ssh

上記の中のファイル
- id_rsa  # 秘密鍵
- id_rsa.pub # 公開鍵
- known_hosts # 通信したホストの証明書が記録される

macの中にvagrant環境がある場合は、  
`/home/vagrant/`の直下に、以下を作成する。  

仮にGitHubにアカウントを作成した場合、　　
複数のクライアントでSSH接続する場合は、  
その全てのクライアントで、公開鍵と秘密鍵を作成して、  
秘密鍵をGitHubの自分のアカウントに登録すれば良い。  
例えば以下の場合  

- 自分のmacのホストOSと、その中のvagrantのゲストOSの2つ
- 自宅のmacと、会社のWindows pcの2つ

ただし、以下の参照によれば、複数のクライアントで、設定を共有できるらしい。    
[ssh-agentを使ってVagrant上のゲストOSからMac側の秘密鍵を使えるようにする](https://firegoby.jp/archives/5694)

---
## 公開鍵と秘密鍵の生成(クライアント)

以下のコマンドで、.sshとその配下のファイルが生成されます。
```
$ ssh-keygen
```
コマンド実行中に3回入力を求められるが、3回ともエンターを入力  
1回目の質問は暗号のタイプを聞かれているが、初期値のRSAが  
最もセキュアなのでそのままで良い。  
2回目と3回目はパスフレーズの入力で省略できる。

生成された公開鍵の確認は以下のコマンドで行う。
```
$ cat ~/.ssh/id_rsa.pub
```

---
## 公開鍵をサーバーに登録する

GitHubの場合は、以下のコマンドで、クリップボードにコピーして、  
GitHubのsettings画面で貼り付ける。
```
$ pbcopy < ~/.ssh/id_rsa.pub
```

それ以外のサーバーで、セキュアに登録できない場合は、以下の方法にする。  

1. scp コマンドを使用して、サーバーに公開鍵ファイルをコピー
1. サーバーの authorized_keys ファイルに公開鍵を追加する

---
## ssh接続テスト
```
$ ssh -T remote-user-name@server-address
```
