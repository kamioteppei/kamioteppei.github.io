<!DOCTYPE html>
<html lang="ja">
<head prefix:og="http://ogp.me/ns#">
  <meta charset="UTF-8">
  <title>Jupyter Notebook | kamioteppei.github.io</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700">
  <!-- Default CSS -->
  <link rel="stylesheet" href="/assets/css/style.css">
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="jupyter notebook">
  <link rel="canonical" href="http://0.0.0.0:4000/memos/jupyter-notebook">
  <link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="kamioteppei.github.io" />
  
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      displayAlign: "left",
      displayIndent: "2em"
    });
  </script>
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script language="JavaScript">
    $(document).ready( function () {
       $("a[href^='http']:not([href*='" + location.hostname + "'])").attr('target', '_blank');
    })
  </script>
</head>
<body>

<header class="header">
  <nav id="nav" class="nav">
    <div class="container nav__container">
      <div class="nav__brand"><a class="nav__title" href="/">kamioteppei.github.io</a></div>
      <div id="nav__btn" class="nav__btn"><i class="fa fa-bars"></i></div>
      <ul id="nav__list" class="nav__list">
        
          <li class="nav__item"><a href="/">Home</a></li>
        
        
          
            <li class="nav__item"><a href="/stack/">Stack</a></li>
          
        
          
            <li class="nav__item"><a href="/blog/">Blog</a></li>
          
        
          
            <li class="nav__item"><a href="/links/">Links</a></li>
          
        
          
        
          
        
          
        
          
        
      </ul>
    </div>
  </nav>
</header>











<div class="contents page">

  
    <div class="container">

      <!--
      <div class="page__header">
  <h1 class="page__title">Jupyter Notebook</h1>
  
  
    <p class="page__date">January 20, 2019</p>
  
</div>

    -->

      <div class="page__body">
        <div class="row">

          <div class="col-2 sidebar order-xs-first">
            <nav id="jqxTree" class="jqxTree">
  <!--
  https://www.siteleaf.com/blog/advanced-liquid-group-by/
  -->
  
  <ul>
    
      <li class="">
        Native
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/android">Android</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/ios">iOS</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/vr">VR/AR</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Environment
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/aws">AWS</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/ci">CI/CD</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/docker">Docker</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/gcp">GCP</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/git">Git</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/heroku">Heroku</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/mac">Mac</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/package-management">Package Manager</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/ssh">SSH</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/ubuntu">Ubuntu</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/vagrant">Vagrant</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        UI/UX
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/bootstrap">Bootstrap</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Engineer
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/career">Career</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/freelance">Freelance</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Machine Learning
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/competition">Competition</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/data">Data</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/elasticsearch">Elasticsearch</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/jupyter-notebook">Jupyter Notebook</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/machine-learning">Machine Learning</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/math">Math</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/nlp">Natural language processing</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Web
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/http">HTTP</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/jekyll">Jekyll</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/markdown">Markdown</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/rails">Rails</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/security">Security</a></div>
          </li>
        
        </ul>
    </li>
    
  </ul>
</nav>

          </div>

          <div class="col-8 main toc-src order-first">
            <h1 id="jupyter-notebook">jupyter notebook</h1>

<h2 id="インストール">インストール</h2>
<p>アナコンダをインストール</p>

<h2 id="ローカルサーバーを起動する">ローカルサーバーを起動する</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd &lt;jupyter notebook&gt;
$ jupyter notebook
</code></pre></div></div>

<h2 id="ローカルサーバーをシャットダウンする">ローカルサーバーをシャットダウンする</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ (crtl + c)
</code></pre></div></div>

<h2 id="カーネル操作">カーネル操作</h2>

<p>セルで、bashを実行するには、コマンドの先頭に<code class="highlighter-rouge">!</code>を付ける</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!pip install -q keras
</code></pre></div></div>
<p>からの</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import keras
</code></pre></div></div>

<h2 id="設定ファイルの作成">設定ファイルの作成</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ jupyter notebook --generate-config
</code></pre></div></div>
<p><code class="highlighter-rouge">~/.jupyter/jupyter_notebook_config.py</code>が作成される。</p>

<h2 id="pythonの実行環境設定">Pythonの実行環境設定</h2>

<p>システム環境、miniconda、仮想環境の交通整理<br />
bashとJupyter Notebookで実行環境が一致することを確認する。</p>

<h3 id="注意">注意</h3>
<p>本章の記述では、condaの仮想環境を作成している記述があるが、最終的には、仮想環境を作成しないことにした。</p>

<p>やりたかったこと</p>
<ul>
  <li>Jupyter Notebookを主に使用し、機械学習の学習を行う。</li>
  <li>また、機械学習の機能をAPI化しても良いように、Jupyterとbashの実行環境を一致させる。(参照先を<code class="highlighter-rouge">/opt/conda/bin</code>にした。)</li>
  <li>Dockerでコンテナ化する。</li>
</ul>

<p>できなかったこと</p>
<ul>
  <li>venv,pyenv,condaを使用して仮想環境を作成する。</li>
</ul>

<p>つまづく所</p>
<ul>
  <li>仮想環境を作成すると、<code class="highlighter-rouge">conda install</code>だと<code class="highlighter-rouge">/opt/conda/bin</code>に、<code class="highlighter-rouge">pip install</code>だと、<code class="highlighter-rouge">/opt/conda/envs/env/bin</code>にインストールされて、統一されない。</li>
  <li>上記理由で、Jupyter Notebookは、<code class="highlighter-rouge">/opt/conda/bin</code>の方にインストールされ、仮想環境(動かしたいバージョンのPython)では動かせない。</li>
  <li>tensorflow-gpuはPython3.4~3.6でサポートされるが、minicondaの最新をインストールしたらPython3.7になり、Jupyter Notebookでは、tensorflow-gpuを使用できない。</li>
</ul>

<p>解決策</p>
<ul>
  <li>minicondaを使用するが、仮想環境は使用しない。<br />
(Dockerコンテナ化されているので、環境の再現性はあるとする。)</li>
  <li>minicondaの最新をインストールするが、直後に、Pythonの3.6を再インストール(Pythonをダウングレード)する。</li>
</ul>

<h3 id="condapipコマンド">conda/pipコマンド</h3>

<ul>
  <li>bashでのインタラクティブモード起動
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python
</code></pre></div>    </div>
  </li>
  <li>Pythonの実行モジュール確認
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ which python
</code></pre></div>    </div>
  </li>
  <li>Pythonの実行モジュールのバージョン確認
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python --version
</code></pre></div>    </div>
  </li>
  <li>pipのライブラリ一覧
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pip list
</code></pre></div>    </div>
    <p>or</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pip freeze
</code></pre></div>    </div>
  </li>
  <li>condaのライブラリ一覧
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ conda list
</code></pre></div>    </div>
  </li>
  <li>pathの確認
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import sys
sys.path
</code></pre></div>    </div>
  </li>
  <li>pipでインストールしたライブラリの格納場所
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pip show hoge
</code></pre></div>    </div>
    <p>一度、<code class="highlighter-rouge">bin</code>階層に<code class="highlighter-rouge">.whl</code>ファイル(zipと同じ)をダウンロードしてから、<code class="highlighter-rouge">lib/python3.6/site-packages</code>にインストール(展開)している。
自分で<code class="highlighter-rouge">clean</code>コマンドをしないとダウンロードしたファイルは消えないと思われる。
<code class="highlighter-rouge">no-cache-dir</code>というオプションがあるのでメモ。</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install --no-cache-dir -r /usr/src/app/requirements.txt
</code></pre></div>    </div>
  </li>
  <li>インストールしたモジュールがimportできるか確認
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import hoge
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="ライブラリの一括適用">ライブラリの一括適用</h3>

<ul>
  <li>ライブラリ一覧をExport
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ conda myenv export &gt; myenv.yaml
</code></pre></div>    </div>
  </li>
  <li>ライブラリーを一括Import
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ conda myenv create --file myenv.yaml
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="jupyter-notebookのkernelに仮想環境を追加">Jupyter NotebookのKernelに仮想環境を追加</h3>

<ul>
  <li>仮想環境を作成
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ conda create -n myenv python=3.6
</code></pre></div>    </div>
  </li>
  <li>condaの仮想環境一覧
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ conda info -e
</code></pre></div>    </div>
    <p>or</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ conda env list
</code></pre></div>    </div>
  </li>
  <li>仮想環境をActiate
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ source activate myenv
(myenv) $ conda install notebook ipykernel
(myenv) $ ipython kernel install --user --name myenv
(myenv) $ jupyter kernelspec list
</code></pre></div>    </div>
    <p>notebookの右上のnewのところで、myenvを選択できるようになる。<br />
既存のnotebookのkernelのプルダウンでも、kernelを変更できるようになっている。</p>
  </li>
</ul>

<h3 id="自作モジュールの使用">自作モジュールの使用</h3>

<p>下記の階層の場合の、自作モジュールのimportの方法について</p>

<ul>
  <li>実行モジュール.py or .ipynb</li>
  <li>my_modules(package)
    <ul>
      <li>__init__.py(packageを再帰的に読み込むためのダミーファイル)</li>
      <li>my_module.py(module)
        <ul>
          <li>my_class(class)
            <ul>
              <li>my_def(function)</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>1.packageはimportできない。パッケージはフォルダだからかな？</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import my_modules
</code></pre></div></div>
<p>-&gt; error</p>

<p>2.moduleはimportできる。fromを使用してもよい。</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import my_modules.my_module
</code></pre></div></div>
<p>-&gt; ok</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from my_modules import my_module
</code></pre></div></div>
<p>-&gt; ok</p>

<p>3.classはimportできるが、fromを使用しないといけない(.でパスを指定できない)</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import my_modules.my_module.myclass
</code></pre></div></div>
<p>-&gt; error</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from my_modules.my_module import myclass
</code></pre></div></div>
<p>-&gt; ok</p>


          </div>

          <div class="col-2 sidebar order-xs-first">
            <nav class="toc"></nav>

          </div>

        </div><!--row-->
      </div><!--page-body-->

    </div><!--container-->

  

</div><!--page-->



<footer class="footer">
  
  <div class="container container--sm footer__container">
  
    <p class="copyright"><small>&copy; 2018 kamioteppei</small></p>

    <div class="social-link">
      
        <p class="social-link__item">
          <a href="https://github.com/kamioteppei"><i class="fa fa-github"></i></a>
        </p>
      
      
    </div>
  </div><!--container-->
</footer>

<script src="/assets/js/jfgp.js"></script>
</body>
</html>
