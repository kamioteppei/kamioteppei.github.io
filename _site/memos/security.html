<!DOCTYPE html>
<html lang="ja">
<head prefix:og="http://ogp.me/ns#">
  <meta charset="UTF-8">
  <title>Security | kamioteppei.github.io</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700">
  <!-- Default CSS -->
  <link rel="stylesheet" href="/assets/css/style.css">
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="Security">
  <link rel="canonical" href="http://0.0.0.0:4000/memos/security">
  <link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="kamioteppei.github.io" />
  
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      displayAlign: "left",
      displayIndent: "2em"
    });
  </script>
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script language="JavaScript">
    $(document).ready( function () {
       $("a[href^='http']:not([href*='" + location.hostname + "'])").attr('target', '_blank');
    })
  </script>
</head>
<body>

<header class="header">
  <nav id="nav" class="nav">
    <div class="container nav__container">
      <div class="nav__brand"><a class="nav__title" href="/">kamioteppei.github.io</a></div>
      <div id="nav__btn" class="nav__btn"><i class="fa fa-bars"></i></div>
      <ul id="nav__list" class="nav__list">
        
          <li class="nav__item"><a href="/">Home</a></li>
        
        
          
            <li class="nav__item"><a href="/stack/">Stack</a></li>
          
        
          
            <li class="nav__item"><a href="/blog/">Blog</a></li>
          
        
          
            <li class="nav__item"><a href="/links/">Links</a></li>
          
        
          
            <li class="nav__item"><a href="/portfolio/">Portfolio</a></li>
          
        
          
        
          
        
          
        
          
        
      </ul>
    </div>
  </nav>
</header>











<div class="contents page">

  
    <div class="container">

      <!--
      <div class="page__header">
  <h1 class="page__title">Security</h1>
  
  
    <p class="page__date">March 13, 2019</p>
  
</div>

    -->

      <div class="page__body">
        <div class="row">

          <div class="col-2 sidebar order-xs-first">
            <nav id="jqxTree" class="jqxTree">
  <!--
  https://www.siteleaf.com/blog/advanced-liquid-group-by/
  -->
  
  <ul>
    
      <li class="">
        Native
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/android">Android</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/ios">iOS</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/react-native">React Native</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/vr">VR/AR</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Front-end
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/angularjs">Angular</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/react">React</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/typescript">Typescript</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/vue">Vue</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Environment
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/aws">AWS</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/ci">CI/CD</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/docker">Docker</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/elasticsearch">Elasticsearch</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/gcp">GCP</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/git">Git</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/heroku">Heroku</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/mac">Mac</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/package-management">Package Manager</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/ssh">SSH</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/ubuntu">Ubuntu</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/vagrant">Vagrant</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        UI/UX
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/bootstrap">Bootstrap</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Engineer
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/career">Career</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/freelance">Freelance</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Machine Learning
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/competition">Competition</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/data">Data</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/jupyter-notebook">Jupyter Notebook</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/machine-learning">Machine Learning</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/math">Math</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/nlp">Natural language processing</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Web
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/http">HTTP</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/jekyll">Jekyll</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/laravel">Laravel</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/markdown">Markdown</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/rails">Rails</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/security">Security</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/spring">Spring</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/swagger">Swagger</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Tools
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/js-fiddle">JS Fiddle</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/sql-fiddle">SQL Fiddle</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        DataBase
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/mysql">MySQL</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/oracle">Oracle</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/postgresql">PostgreSQL</a></div>
          </li>
        
        </ul>
    </li>
    
  </ul>
</nav>

          </div>

          <div class="col-8 main toc-src order-first">
            <h1 id="security">Security</h1>

<h2 id="アカウント作成">アカウント作成</h2>

<h3 id="メールアドレス">メールアドレス</h3>

<p>メールアドレスをユーザー登録の論理キーにする。<br />
入力されたメールアドレスは、小文字に変換して、データベースに登録し、一意にする。
ただし、ログイン字は、大文字小文字の違いを無視して、findする。</p>

<h3 id="パスワード">パスワード</h3>

<p>パスワードをデータベースに登録する場合、平文で登録してはいけない。<br />
データベースが外部からアクセスされた場合に、パスワードが悪用される。</p>

<p>Railsでは、<code class="highlighter-rouge">User</code>モデルに<code class="highlighter-rouge">has_secure_password</code>属性を付けると、<br />
自動的に、<code class="highlighter-rouge">password</code>と<code class="highlighter-rouge">password_confirmation</code>というフィールドと、<br />
<code class="highlighter-rouge">password_digest</code>というDBカラムへの登録機能を持つ。<br />
<code class="highlighter-rouge">password_digest</code>カラムには、ハッシュ化されたパスワードが登録される。</p>

<h2 id="ハッシュ化と暗号化">ハッシュ化と暗号化</h2>

<h3 id="ハッシュ化">ハッシュ化</h3>
<ul>
  <li>復号：不可</li>
  <li>用途：DBに保存するパスワード<br />
ユーザーアカウント作成時に、システム管理者は、ユーザーのパスワードの平文を知る必要はない。<br />
よって、DBにはパスワードのハッシュを登録する。そうすれば、外部に漏れてもあまり問題はない。</li>
  <li>アルゴリズム：MD5(脆弱),SHA-1(脆弱),SHA-2(推奨)</li>
</ul>

<p>ハッシュ化の注意点<br />
ハッシュからは平文に復号できないが、可能性的には、例えば６文字のパスワードに限った話でいうと
、可能性のある文字列の全パターンをハッシュ化した時の、平文とハッシュのリストがあれば、ハッシュから平文が逆引きできる。<br />
上記のリストをレインボーテーブルという。その対策として、平文にsaltという任意の文字列を<br />
付加してからハッシュ化すると、レインボーリストを作成することは難しくなる。<br />
saltを追加して26文字以上にすると、セキュアらしい。<br />
<a href="https://dev.classmethod.jp/security/rainbowtable/">参照</a></p>

<h3 id="暗号化">暗号化</h3>
<ul>
  <li>復号：可能</li>
  <li>用途：httpsセッションで通信するパスワード<br />
ユーザーログイン時に、ブラウザで入力したパスワードを暗号化して、サーバーに送信する。<br />
認証処理で、パスワードを平文に復号し、平文をハッシュ化することで、上記のDBのパスワードと<br />
一致比較することができる。</li>
  <li>アルゴリズム：RSA(推奨),DSA,DES</li>
</ul>

<h2 id="アプリのssl強制設定">アプリのSSL強制設定</h2>

<p>Railsアプリでは、<code class="highlighter-rouge">config/environments/production.rb</code>に以下を追加する。</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Rails.application.configure do
  # Force all access to the app over SSL, use Strict-Transport-Security,
  # and use secure cookies.
  config.force_ssl = true
end
</code></pre></div></div>

<h2 id="strong-parameters">Strong Parameters</h2>

<p>Railsのコントローラーで、リクエストからのパラメータを使用する時に、
指定したパラメータ以外は使用しない機能。
<code class="highlighter-rouge">admin='1'</code>等の不正なパラメータをクライアントに使用させない。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def user_params
  params.require(:user).permit(:name, :email, :password,
                               :password_confirmation)
end
</code></pre></div></div>

<h2 id="token">Token</h2>
<p>以下のアクションで、tokenを発行して一致するか確認する。</p>
<ul>
  <li>ユーザーのアクティベート</li>
  <li>ログイン状態の保存</li>
  <li>パスワード変更</li>
</ul>

<p>Tokenの有効期限を設定するとなお良い。</p>

<h2 id="cookies">Cookies</h2>
<p>セキュリティ上、セッションidのみCookieでやりとりする方式が一般的</p>

<h2 id="sessionidとtoken">SessionIdとToken</h2>

<h3 id="sessionid">SessionId</h3>
<ul>
  <li>Cookieに保存するのでブラウザを使用するアプリで使用可能。<br />
i-Phoneなどのアプリからは仕組みを実装しないと使用できない。</li>
  <li>SessionIdの値は、文字列</li>
  <li>WebサーバーにSession情報を保持するので、ロードバランサーを <br />
使用している場合に、Session保持中のサーバーに接続する仕組みが必要。</li>
</ul>

<h3 id="token-1">Token</h3>
<ul>
  <li>DBに保存する</li>
  <li>値はjson形式で、ユーザーの権限などを自由に設定できる。 <br />
ただし、通信に負荷がかからないように、情報は最小限にする</li>
  <li>DBに保存するので、ステートレスである。よってオートスケールのWebサーバー<br />
からでも容易に使用できる。</li>
  <li>OAuth2.0やJWT(json web token)を理解する必要がある</li>
</ul>

<h3 id="oauth20">OAuth2.0</h3>
<p>要約</p>
<ul>
  <li>認証と認可を分けて考える</li>
  <li>ユーザーはAPIから認証の仕組みを受け取り、認証する(ユーザーIDとパスワード)</li>
  <li>上記作業により、クライアント(アプリ)は、APIからトークンを受け取る。</li>
  <li>APIはクライアント(アプリ)から、トークンを受け取り、アクセスを認可する。</li>
</ul>

<p>注意
セキュリティの観点から、クライアント(アプリ)に、ユーザーのユーザーIDとパスワードを
渡してはいけない。なぜなら、クライアントが、ユーザーの代わりに何でも、操作できてしまうから。</p>

<h2 id="セッションハイジャック">セッションハイジャック</h2>

<h2 id="クロスサイトスクリプティングxss">クロスサイトスクリプティング(XSS)</h2>

<h2 id="クロスサイトリクエストフォージェリcsrf">クロスサイトリクエストフォージェリ(CSRF)</h2>

<h2 id="ブラウザ">ブラウザ</h2>

<p>信用できるブラウザのアドオンを入れた時に、<br />
後に、そのアドオンの権利を悪意のある人が手に入れて、<br />
悪用される可能性がある。</p>

<p><a href="https://blog.clock-up.jp/entry/2016/11/03/http-headers-malware">参照</a></p>


          </div>

          <div class="col-2 sidebar order-xs-first">
            <nav class="toc"></nav>

          </div>

        </div><!--row-->
      </div><!--page-body-->

    </div><!--container-->

  

</div><!--page-->



<footer class="footer">
  
  <div class="container container--sm footer__container">
  
    <p class="copyright"><small>&copy; 2018 kamioteppei</small></p>

    <div class="social-link">
      
        <p class="social-link__item">
          <a href="https://github.com/kamioteppei"><i class="fa fa-github"></i></a>
        </p>
      
      
    </div>
  </div><!--container-->
</footer>

<script src="/assets/js/jfgp.js"></script>
</body>
</html>
