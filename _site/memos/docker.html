<!DOCTYPE html>
<html lang="ja">
<head prefix:og="http://ogp.me/ns#">
  <meta charset="UTF-8">
  <title>Docker | kamioteppei.github.io</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700">
  <!-- Default CSS -->
  <link rel="stylesheet" href="/assets/css/style.css">
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="Docker">
  <link rel="canonical" href="http://0.0.0.0:4000/memos/docker">
  <link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="kamioteppei.github.io" />
  
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      displayAlign: "left",
      displayIndent: "2em"
    });
  </script>
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script language="JavaScript">
    $(document).ready( function () {
       $("a[href^='http']:not([href*='" + location.hostname + "'])").attr('target', '_blank');
    })
  </script>
</head>
<body>

<header class="header">
  <nav id="nav" class="nav">
    <div class="container nav__container">
      <div class="nav__brand"><a class="nav__title" href="/">kamioteppei.github.io</a></div>
      <div id="nav__btn" class="nav__btn"><i class="fa fa-bars"></i></div>
      <ul id="nav__list" class="nav__list">
        
          <li class="nav__item"><a href="/">Home</a></li>
        
        
          
            <li class="nav__item"><a href="/stack/">Stack</a></li>
          
        
          
            <li class="nav__item"><a href="/blog/">Blog</a></li>
          
        
          
            <li class="nav__item"><a href="/links/">Links</a></li>
          
        
          
            <li class="nav__item"><a href="/portfolio/">Portfolio</a></li>
          
        
          
        
          
        
          
        
          
        
      </ul>
    </div>
  </nav>
</header>











<div class="contents page">

  
    <div class="container">

      <!--
      <div class="page__header">
  <h1 class="page__title">Docker</h1>
  
  
    <p class="page__date">April 14, 2019</p>
  
</div>

    -->

      <div class="page__body">
        <div class="row">

          <div class="col-2 sidebar order-xs-first">
            <nav id="jqxTree" class="jqxTree">
  <!--
  https://www.siteleaf.com/blog/advanced-liquid-group-by/
  -->
  
  <ul>
    
      <li class="">
        Native
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/android">Android</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/ios">iOS</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/react-native">React Native</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/vr">VR/AR</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Front-end
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/angularjs">Angular</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/react">React</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/typescript">Typescript</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/vue">Vue</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Environment
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/aws">AWS</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/ci">CI/CD</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/docker">Docker</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/elasticsearch">Elasticsearch</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/gcp">GCP</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/git">Git</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/heroku">Heroku</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/mac">Mac</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/package-management">Package Manager</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/ssh">SSH</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/ubuntu">Ubuntu</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/vagrant">Vagrant</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        UI/UX
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/bootstrap">Bootstrap</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Engineer
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/career">Career</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/freelance">Freelance</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Machine Learning
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/competition">Competition</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/data">Data</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/jupyter-notebook">Jupyter Notebook</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/machine-learning">Machine Learning</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/math">Math</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/nlp">Natural Language Processing</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/opencv">OpenCV</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/python">Python</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Web
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/http">HTTP</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/jekyll">Jekyll</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/laravel">Laravel</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/markdown">Markdown</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/rails">Rails</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/security">Security</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/spring">Spring</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/swagger">Swagger</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        Tools
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/js-fiddle">JS Fiddle</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/sql-fiddle">SQL Fiddle</a></div>
          </li>
        
        </ul>
    </li>
    
      <li class="">
        DataBase
        <ul>
        
          <li class="">
            <div class=""><a href="/memos/mysql">MySQL</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/oracle">Oracle</a></div>
          </li>
        
          <li class="">
            <div class=""><a href="/memos/postgresql">PostgreSQL</a></div>
          </li>
        
        </ul>
    </li>
    
  </ul>
</nav>

          </div>

          <div class="col-8 main toc-src order-first">
            <h1 id="docker">Docker</h1>

<h2 id="インストール">インストール</h2>

<h3 id="docker-1">Docker</h3>

<p><a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">公式サイト</a>にしたがって、
Docker CE for Ubuntuをインストールする。</p>

<p>リポジトリからインストールする手順を実行する。</p>

<h3 id="docker-compose">Docker Compose</h3>

<p><a href="https://docs.docker.com/compose/install/#install-compose">公式サイト</a>にしたがって、
docker-composeをインストールする。</p>

<h2 id="初期設定">初期設定</h2>

<p>sudo無しでdockerコマンド使えるようにユーザをグループに追加。<br />
docker/docker-composeコマンドを実行して、エラーになった場合、権限の問題であれば、
sudoするか、この設定にすると、うまくいく。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo groupadd docker
sudo gpasswd -a $USER docker
sudo service docker restart
# sudo systemctl restart docker # １つ上の代替
sudo reboot
</code></pre></div></div>
<p><a href="https://qiita.com/t2kmt/items/b3be56d4df5f80c555af#2-dockerインストール">参照</a></p>

<h2 id="dockerサービス">dockerサービス</h2>

<ul>
  <li>サービス起動状態確認
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl status docker
</code></pre></div>    </div>
    <p>ctrl+cで確認画面から抜ける</p>
  </li>
  <li>サービス起動/終了/再起動
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl start docker
$ sudo systemctl stop docker
$ sudo systemctl restart docker
</code></pre></div>    </div>
  </li>
  <li>サービス自動起動設定
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl enable docker
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="dockerコマンドのflow">dockerコマンドのflow</h2>

<p>下記サイトの図を参照<br />
<a href="https://morizyun.github.io/docker/about-docker-command.html">Dockerでよく使うコマンドまとめ</a></p>

<p>Dockerイメージの操作</p>
<ul>
  <li>docker login  -&gt; Docker Hubにログインする。</li>
  <li>docker search  -&gt; Docker HubのDockerイメージを検索する。<br />
イメージの命名規則は、<code class="highlighter-rouge">組織名(個人名) / イメージ名 : タグ名(イメージのバージョンの説明)</code></li>
  <li>docker pull  -&gt;　 Docker HubのDockerイメージをローカルにダウンロードする。</li>
  <li>docker images  -&gt; ローカルのDockerイメージのリストを表示する。</li>
  <li>docker tag  -&gt; ローカルのDockerイメージにタグをつける。</li>
  <li>
    <p>docker inspect  -&gt; 指定したDockerイメージの設定の詳細を表示する。</p>

    <p>Dockerコンテナの操作</p>
    <ul>
      <li>docker run -&gt; DockerイメージからDockerコンテナを起動する。</li>
      <li>docker ps  -&gt;　タスクが起動中のDockerコンテナのリストを表示する。</li>
      <li>docker ps -a  -&gt; 全てのDockerコンテナのリストを表示する。</li>
      <li>docker stats -a  -&gt; 起動中のDockerコンテナのcpuやメモリの使用状況を表示する。</li>
      <li>docker exec  -&gt; 指定したDockerコンテナでコマンドを実行する。
<code class="highlighter-rouge">docker exec -it コンテナID先頭3桁 bash</code>で、シェル操作できる。</li>
      <li>docker attach  -&gt; Dockerコンテナに起動しているPID=1のプロセスの標準入力(STDIN)と、標準出力(STDOUT)に接続する。</li>
      <li>docker stop  -&gt; 指定したDockerコンテナを停止する。</li>
      <li>docker kill  -&gt; 指定したDockerコンテナを強制終了する。</li>
      <li>docker start  -&gt; 指定したDockerコンテナを起動する。
<code class="highlighter-rouge">-a</code>で、コンテナの起動と同時に、初期プロセスにattachする。</li>
      <li>docker restart  -&gt; 指定したDockerコンテナを再起動する。</li>
      <li>docker rm  -&gt; 指定したDockerコンテナを削除する。</li>
      <li>docker cp &lt;container_id&gt;:&lt;guest_file_path&gt; &lt;host_file_path&gt; -&gt; コンテナからホストにファイルをコピーする</li>
      <li>docker cp &lt;host_file_path&gt; &lt;container_id&gt;:&lt;guest_file_path&gt; -&gt; ホストからコンテナにファイルをコピーする</li>
    </ul>
  </li>
  <li>docker commit -&gt; DockerコンテナをDockerイメージに変換する。</li>
  <li>docker build -&gt; DockerfileからDockerイメージを作成する。</li>
  <li>docker push -&gt; ローカルのDockerイメージをDocker Hubにアップロードする。</li>
  <li>docker rmi  -&gt; Dockerイメージの削除</li>
</ul>

<h2 id="dockerfile">Dockerfile</h2>

<p>dockerでは、linuxのスタートアップのような仕組みは使用しない。<br />
dockerは、基本的に1コンテナ1タスクで使用する。<br />
Dockerイメージを作成するときに、Dockerfileで<code class="highlighter-rouge">CMD</code>か<code class="highlighter-rouge">ENTRYPOINT</code>の属性で、<br />
コンテナ起動時に、実行するコマンドを指定する。</p>

<p>tensorflow-gpuのDocker Imageをrunすると、引数にcommandを渡さなくても、<br />
jupyter notebookが立ちあがる。docker runで作成されたコンテナのルートに、<br />
<code class="highlighter-rouge">run_jupyter.sh</code>があるので、それを呼んでいる。</p>

<p>DockerfileのCMDを確認する場合は、ホストで、以下のコマンドを実行する。</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker inspect [イメージのid先頭3桁]
</code></pre></div></div>

<p>もちろん、<code class="highlighter-rouge">docker run</code>するときに、実行するコマンドを渡せば、それが優先される。</p>

<p><a href="https://qiita.com/hihihiroro/items/d7ceaadc9340a4dbeb8f">参照</a></p>

<h2 id="docker-compose-1">Docker Compose</h2>

<p>以下を参照<br />
<a href="https://qiita.com/y_hokkey/items/d51e69c6ff4015e85fce">docker-composeを使うと複数コンテナの管理が便利に</a></p>

<h3 id="コマンド">コマンド</h3>

<ul>
  <li>
    <p>クラスタの起動<br />
<code class="highlighter-rouge">docker-compose.yml</code>ファイルを作成し、<code class="highlighter-rouge">docker-compose up</code>を実行する。<br />
<code class="highlighter-rouge">docker-compose up -d</code>で、dettach起動。</p>
  </li>
  <li>
    <p>クラスタの停止 <br />
attach起動なら、ctrl+cで終了。<br />
dettach起動なら、<code class="highlighter-rouge">docker-compose stop</code>で終了。</p>
  </li>
  <li>
    <p>クラスタの削除 <br />
<code class="highlighter-rouge">docker-compose rm</code></p>
  </li>
</ul>


          </div>

          <div class="col-2 sidebar order-xs-first">
            <nav class="toc"></nav>

          </div>

        </div><!--row-->
      </div><!--page-body-->

    </div><!--container-->

  

</div><!--page-->



<footer class="footer">
  
  <div class="container container--sm footer__container">
  
    <p class="copyright"><small>&copy; 2018 kamioteppei</small></p>

    <div class="social-link">
      
        <p class="social-link__item">
          <a href="https://github.com/kamioteppei"><i class="fa fa-github"></i></a>
        </p>
      
      
    </div>
  </div><!--container-->
</footer>

<script src="/assets/js/jfgp.js"></script>
</body>
</html>
